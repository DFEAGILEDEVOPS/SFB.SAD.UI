<app-dashboard-bread-crumb [urn]='this.activeScenario.urn' [name]='this.activeScenario.name'></app-dashboard-bread-crumb>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 class="govuk-heading-xl">Self-assessment dashboard</h1>
    <p class="govuk-body-s">
      Assessing
      <span class="highlight">
        <span class="govuk-!-font-weight-bold">{{activeScenario.name}}</span>
      </span>
      using
      <span class="govuk-!-font-weight-bold">{{activeScenario.termOfScenario}}</span>
      finance data. This data includes
      <span class="govuk-!-font-weight-bold">MAT central finance</span>.
    </p>
  </div>
</div>

<app-dashboard-characteristics
[phase]='activeScenario.overallPhaseWSixthForm'
[londonWeight]='activeScenario.londonWeighting'
[noPupils]='activeScenario.numberOfPupils'
[FSM]='activeScenario.fsm'
[SizeLookup]='activeScenario.sadSizeLookup'
[FSMLookup]='activeScenario.sadFSMLookup'
></app-dashboard-characteristics>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <div class="float-right">
      <button class="govuk-button govuk-!-margin-right-4" data-module="govuk-button">
        Add a side-by-side scenario
      </button>
      <button class="govuk-button govuk-button--secondary" data-module="govuk-button"
        routerLink='/self-assessment/editing-format/{{urn}}/{{activeScenario.name}}'>
        Edit data
      </button>
    </div>
  </div>
</div>

<h2 class="govuk-heading-m">{{activeScenario.scenarioName}}</h2>

<table class="govuk-table">
  <caption class="govuk-table__caption govuk-!-font-size-24">Spending</caption>
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header">Assessment area</th>
      <th scope="col" class="govuk-table__header govuk-table__header--numeric">School data</th>
      <th scope="col" class="govuk-table__header govuk-table__header--numeric">% of exp.</th>
      <th scope="col" class="govuk-table__header">Rating against tresholds</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    <tr class="govuk-table__row" *ngFor='let aa of activeScenario.spendingAAs'>
      <td class="govuk-table__cell">{{aa.assessmentAreaName}}</td>
      <td class="govuk-table__cell govuk-table__cell--numeric">{{aa.schoolData | currency: 'GBP' :'symbol': '1.0-0'}}</td>
      <td class="govuk-table__cell govuk-table__cell--numeric">{{aa.percentageSchoolData | percent : '1.0-1'}}</td>
      <td *ngIf="aa.schoolData" class="govuk-table__cell">
        <span class="rating-box" [class]='aa.matchingTreshold.ratingColour'>{{aa.matchingTreshold.ratingText}}</span>
        <img src="assets/images/help-icon.png" class="small-icon rating-help-icon" (click)="openModalWithComponent(aa.assessmentAreaName)" />
      </td>
      <td *ngIf="!aa.schoolData" class="govuk-table__cell">
        <span class="rating-box gray">
          <span>Not available.</span>
          <a class="govuk-link ml-2 button-link" routerLink='/self-assessment/edit-data/{{activeScenario.urn}}'>Add data</a>
        </span>
        <img src="assets/images/help-icon.png" class="small-icon rating-help-icon" />
      </td>
    </tr>
  </tbody>
</table>

<table class="govuk-table">
  <caption class="govuk-table__caption govuk-!-font-size-24">Reserve and balance</caption>
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header">Assessment area</th>
      <th scope="col" class="govuk-table__header govuk-table__header--numeric">School data</th>
      <th scope="col" class="govuk-table__header govuk-table__header--numeric">% of income</th>
      <th scope="col" class="govuk-table__header">Rating against tresholds</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    <tr class="govuk-table__row" *ngFor='let aa of activeScenario.reserveAAs'>
      <td class="govuk-table__cell">{{aa.assessmentAreaName}}</td>
      <td class="govuk-table__cell govuk-table__cell--numeric">{{aa.schoolData | currency: 'GBP' :'symbol': '1.0-0'}}</td>
      <td class="govuk-table__cell govuk-table__cell--numeric">{{aa.percentageSchoolData | percent : '1.0-1'}}</td>
      <td *ngIf="aa.schoolData" class="govuk-table__cell">
        <span class="rating-box" [class]='aa.matchingTreshold.ratingColour'>{{aa.matchingTreshold.ratingText}}</span>
        <img src="assets/images/help-icon.png" class="small-icon rating-help-icon" (click)="openModalWithComponent(aa.assessmentAreaName)" />
      </td>
      <td *ngIf="!aa.schoolData" class="govuk-table__cell">
        <span class="rating-box gray">
          <span>Not available.</span>
          <a class="govuk-link ml-2 button-link" routerLink='/self-assessment/edit-data/{{activeScenario.urn}}'>Add data</a>
        </span>
        <img src="assets/images/help-icon.png" class="small-icon rating-help-icon" />
      </td>
    </tr>
  </tbody>
</table>

<table class="govuk-table">
  <caption class="govuk-table__caption govuk-!-font-size-24">School characteristics</caption>
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header">Assessment area</th>
      <th scope="col" class="govuk-table__header govuk-table__header--numeric">School data</th>
      <th scope="col" class="govuk-table__header">Rating against tresholds</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    <tr class="govuk-table__row" *ngFor='let aa of activeScenario.characteristicAAs'>
      <td class="govuk-table__cell">{{aa.assessmentAreaName}}</td>
      <td class="govuk-table__cell govuk-table__cell--numeric">
          <span *ngIf="aa.schoolDataFormat ==='currency'">{{aa.percentageSchoolData | currency: 'GBP' :'symbol': '1.0-0'}}</span>
          <span *ngIf="aa.schoolDataFormat ==='percentageOfExp' || aa.schoolDataFormat ==='percentageOfInc' || aa.schoolDataFormat==='percentageOfWf'">{{aa.percentageSchoolData | percent: '1.0-0'}}</span>
          <span *ngIf="aa.schoolDataFormat ==='number'">{{aa.percentageSchoolData | number: '1.0-1'}}</span>
          <span *ngIf="!aa.schoolData">--</span>
      </td>
      <td *ngIf="aa.schoolData" class="govuk-table__cell">
        <span class="rating-box" [class]='aa.matchingTreshold.ratingColour'>{{aa.matchingTreshold.ratingText}}</span>
        <img src="assets/images/help-icon.png" class="small-icon rating-help-icon" (click)="openModalWithComponent(aa.assessmentAreaName)" />
      </td>
      <td *ngIf="!aa.schoolData" class="govuk-table__cell">
        <span class="rating-box gray">
          <span>Not available.</span>
          <a class="govuk-link ml-2 button-link" routerLink='/self-assessment/edit-data/{{activeScenario.urn}}'>Add data</a>
        </span>
        <img src="assets/images/help-icon.png" class="small-icon rating-help-icon" />
      </td>
    </tr>
  </tbody>
</table>

<table class="govuk-table">
  <caption class="govuk-table__caption govuk-!-font-size-24">Outcomes</caption>
  <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th scope="col" class="govuk-table__header">Assessment area</th>
      <th scope="col" class="govuk-table__header">School data</th>
    </tr>
  </thead>
  <tbody class="govuk-table__body">
    <tr class="govuk-table__row">
      <td class="govuk-table__cell">Ofsted rating</td>
      <td class="govuk-table__cell">
        <span class="rating rating-{{activeScenario.ofstedRating}}"> {{activeScenario.ofstedRating}} </span>
        <span [ngSwitch]="activeScenario.ofstedRating">
          <span class="govuk-!-font-weight-bold" *ngSwitchCase="'1'"> Outstanding</span>
          <span class="govuk-!-font-weight-bold" *ngSwitchCase="'2'"> Good</span>
          <span class="govuk-!-font-weight-bold" *ngSwitchCase="'3'"> Requires improvement</span>
          <span class="govuk-!-font-weight-bold" *ngSwitchCase="'4'"> Inadequate</span>
        </span> |
        <a class="govuk-link" target="_blank" rel="external noopener noreferrer" href="https://reports.ofsted.gov.uk/inspection-reports/find-inspection-report/provider/ELS/{{activeScenario.urn}}">Ofsted report</a> |
        <span>Inspected {{ activeScenario.ofstedInspectionDate | date : 'dd MMMM yyyy' }}</span>
      </td>
    </tr>
    <tr class="govuk-table__row" *ngIf="activeScenario.progressScoreType === 'KS2 score'">
      <td class="govuk-table__cell">{{activeScenario.progressScoreType}}</td>
      <td class="govuk-table__cell progress-td">
        <span class="progress-text" [ngClass]="{
              'progress-text-well-below': activeScenario.progressScore < -3 ,
              'progress-text--below': activeScenario.progressScore >= -3 && activeScenario.progressScore < -2,
              'progress-text--average': activeScenario.progressScore >= -2 && activeScenario.progressScore <= 2,
              'progress-text--above': activeScenario.progressScore <= 3 && activeScenario.progressScore > 2,
              'progress-text--well-above': activeScenario.progressScore > 3}">
          {{activeScenario.progressScore | number: '1.2-2'}}
          <span *ngIf="activeScenario.progressScore < -3">&nbsp; Well below average</span>
          <span *ngIf="activeScenario.progressScore >= -3 && activeScenario.progressScore < -2">&nbsp; Below average</span>
          <span *ngIf="activeScenario.progressScore >= -2 && activeScenario.progressScore <= 2">&nbsp; Average</span>
          <span *ngIf="activeScenario.progressScore <= 3 && activeScenario.progressScore > 2">&nbsp; Above average</span>
          <span *ngIf="activeScenario.progressScore > 3">&nbsp; Well above average</span>
        </span>
      </td>
    </tr>
    <tr class="govuk-table__row" *ngIf="activeScenario.progressScoreType === 'Progress 8 score'">
      <td class="govuk-table__cell">{{activeScenario.progressScoreType}}</td>
      <td class="govuk-table__cell progress-td">
        <span class="progress-text" [ngClass]="{
              'progress-text--well-below': activeScenario.progress8Banding === 5,
              'progress-text--below': activeScenario.progress8Banding === 4,
              'progress-text--average': activeScenario.progress8Banding === 3,
              'progress-text--above': activeScenario.progress8Banding === 2,
              'progress-text--well-above': activeScenario.progress8Banding === 1}">
          {{activeScenario.progressScore | number: '1.2-2'}}
          <span [ngSwitch]="activeScenario.progress8Banding">
            <span *ngSwitchCase="5">&nbsp; Well below average</span>
            <span *ngSwitchCase="4">&nbsp; Below average</span>
            <span *ngSwitchCase="3">&nbsp; Average</span>
            <span *ngSwitchCase="2">&nbsp; Above average</span>
            <span *ngSwitchCase="1">&nbsp; Well above average</span>
          </span>
        </span>
      </td>
    </tr>
  </tbody>
</table>

