<app-edit-data-breadcrumb [name]='scenarioInEdit?.name' [urn]='scenarioInEdit?.urn' [viewType]='viewType'>
</app-edit-data-breadcrumb>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <h1 *ngIf='viewType === "edit"' class="govuk-heading-xl">Edit data</h1>
    <h1 *ngIf='viewType === "enter"' class="govuk-heading-xl">Enter data</h1>
    <p class="govuk-body-s">
      Assessing
      <span class="highlight">
        <span class="govuk-!-font-weight-bold">{{scenarioInEdit?.name}}</span>
      </span>
    </p>
  </div>
</div>

<hr class="govuk-section-break govuk-section-break--m">

<div [hidden]='!scenarioLoaded'>
  <form (ngSubmit)="onSubmit()" [formGroup]="editDataForm">

    <fieldset class="govuk-fieldset" formGroupName='scenarioDetails'>
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        <h2 class="govuk-fieldset__heading">
          Scenario details
        </h2>
      </legend>
      <div class="govuk-form-group" [class]="{'govuk-form-group--error' : !scenarioName.valid && !scenarioName.pristine}">
        <label class="govuk-label" for="scenario-name">
          Name of scenario
        </label>
        <input class="govuk-input govuk-input--width-20" id="scenario-name" name="scenario-name" type="text"
          formControlName='scenarioName' [class]="{'govuk-input--error' : !scenarioName.valid && !scenarioName.pristine}"
          required>
        <div *ngIf="scenarioName.invalid && scenarioName.dirty">
          <span *ngIf="scenarioName.errors.required" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Scenario name is required
          </span>
          <span *ngIf="scenarioName.errors.minlength" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Scenario name must be minimum 3 characters
          </span>
        </div>
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="scenario-term">
          Year of scenario
        </label>
        <select class="govuk-select" id="scenario-term" name="scenario-term" formControlName='scenarioTerm'>
          <option value="2017/2018">2017/2018</option>
          <option value="2018/2019">2018/2019</option>
          <option value="2019/2020">2019/2020</option>
          <option value="2020/2021">2020/2021</option>
        </select>
      </div>
    </fieldset>

    <fieldset class="govuk-fieldset" formGroupName='schoolDetails'>
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        <h2 class="govuk-fieldset__heading">
          School details
        </h2>
      </legend>

      <div class="govuk-form-group"
        [class]="{'govuk-form-group--error' : !numberOfPupils.valid && !numberOfPupils.pristine}">
        <label class="govuk-label" for="number-pupils">
          Number of pupils (FTE)
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.numberOfPupilsLatestTerm}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="number-pupils" name="number-pupils" type="number"
          formControlName='numberOfPupils'
          [class]="{'govuk-input--error' : !numberOfPupils.valid && !numberOfPupils.pristine}" required>
        <div *ngIf="numberOfPupils.invalid && numberOfPupils.dirty">
          <span *ngIf="numberOfPupils.errors.required" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Number of pupils is required
          </span>
          <span *ngIf="numberOfPupils.errors.min" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Number of pupils must be minimum 1
          </span>
        </div>
      </div>

      <div class="govuk-form-group" [class]="{'govuk-form-group--error' : !schoolWorkforce.valid && !schoolWorkforce.pristine}">
        <label class="govuk-label" for="school-workforce">
          School workforce (FTE)
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.workforceTotalLastTerm}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="school-workforce" name="school-workforce" type="number"
          formControlName='schoolWorkforce'
          [class]="{'govuk-input--error' : !schoolWorkforce.valid && !schoolWorkforce.pristine}" required>
        <div *ngIf="schoolWorkforce.invalid && schoolWorkforce.dirty">
          <span *ngIf="schoolWorkforce.errors.required" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> School workforce count is required
          </span>
          <span *ngIf="schoolWorkforce.errors.min" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> School workforce count must be minimum 1
          </span>
        </div>
      </div>

      <div class="govuk-form-group" [class]="{'govuk-form-group--error' : !numberOfTeachers.valid && !numberOfTeachers.pristine}">
        <label class="govuk-label" for="number-teachers">
          Number of teachers (FTE)
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.teachersTotalLastTerm}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="number-teachers" name="number-teachers" type="number"
          formControlName='numberOfTeachers'
          [class]="{'govuk-input--error' : !numberOfTeachers.valid && !numberOfTeachers.pristine}" required>
        <div *ngIf="numberOfTeachers.invalid && numberOfTeachers.dirty">
          <span *ngIf="numberOfTeachers.errors.required" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Number of teachers is required
          </span>
          <span *ngIf="numberOfTeachers.errors.min" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Number of teachers must be minimum 1
          </span>
        </div>
      </div>

      <div class="govuk-form-group" [class]="{'govuk-form-group--error' : !seniorLeadership.valid && !seniorLeadership.pristine}">
        <label class="govuk-label" for="senior-leadership">
          Senior leadership (FTE)
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.teachersLeaderLastTerm}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="senior-leadership" name="senior-leadership" type="number"
          formControlName='seniorLeadership'
          [class]="{'govuk-input--error' : !seniorLeadership.valid && !seniorLeadership.pristine}" required>
        <div *ngIf="seniorLeadership.invalid && seniorLeadership.dirty">
          <span *ngIf="seniorLeadership.errors.required" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Senior leadership number is required
          </span>
          <span *ngIf="seniorLeadership.errors.min" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Senior leadership number must be minimum 0
          </span>
        </div>
      </div>

      <div class="govuk-form-group" [class]="{'govuk-form-group--error' : !fsm.valid && !fsm.pristine}">
        <label class="govuk-label" for="fsm">
          Percentage of pupils eligible for FSM
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.fsmLatestTerm}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="fsm" name="fsm" type="number" formControlName='fsm'
          [class]="{'govuk-input--error' : !fsm.valid && !fsm.pristine}" required>
        <div *ngIf="fsm.invalid && fsm.dirty">
          <span *ngIf="fsm.errors.required" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Percentage of pupils eligible for FSM is required
          </span>
          <span *ngIf="fsm.errors.min" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Percentage of pupils eligible for FSM must be minimum 0
          </span>
        </div>
      </div>
      <div class="govuk-form-group"
        [class]="{'govuk-form-group--error' : !teacherContactRatio.valid && !teacherContactRatio.pristine}">
        <label class="govuk-label" for="tcr">
          Teacher contact ratio (less than 1)
        </label>
        <input class="govuk-input govuk-input--width-20" id="tcr" name="tcr" type="number"
          formControlName='teacherContactRatio'
          [class]="{'govuk-input--error' : !teacherContactRatio.valid && !teacherContactRatio.pristine}">
        <div *ngIf="teacherContactRatio.invalid && teacherContactRatio.dirty">
          <span *ngIf="teacherContactRatio.errors.min" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Teacher contact ratio must be minimum 0
          </span>
          <span *ngIf="teacherContactRatio.errors.max" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Teacher contact ratio must be maximum 1
          </span>
        </div>
      </div>

      <div class="govuk-form-group" [class]="{'govuk-form-group--error' : !predictedPupil.valid && !predictedPupil.pristine}">
        <label class="govuk-label" for="ppl">
          Predicted percentage pupil number change in 3-5 years
        </label>
        <input class="govuk-input govuk-input--width-20" id="ppl" name="ppl" type="number" formControlName='predictedPupil'
        [class]="{'govuk-input--error' : !predictedPupil.valid && !predictedPupil.pristine}">
        <div *ngIf="predictedPupil.invalid && predictedPupil.dirty">
          <span *ngIf="predictedPupil.errors.min" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Predicted pupil number change percentage must be minimum -100
          </span>
        </div>
      </div>

      <div class="govuk-form-group"
        [class]="{'govuk-form-group--error' : !averageClassSize.valid && !averageClassSize.pristine}">
        <label class="govuk-label" for="acs">
          Average Class size
        </label>
        <input class="govuk-input govuk-input--width-20" id="acs" name="acs" type="number" formControlName='averageClassSize'
          [class]="{'govuk-input--error' : !averageClassSize.valid && !averageClassSize.pristine}">
        <div *ngIf="averageClassSize.invalid && averageClassSize.dirty">
          <span *ngIf="averageClassSize.errors.min" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Average class size must be minimum 0
          </span>
        </div>
      </div>

    </fieldset>

    <fieldset class="govuk-fieldset" formGroupName='reserveBalance'>
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        <h2 class="govuk-fieldset__heading">
          Totals
        </h2>
      </legend>
      <div class="govuk-form-group" [class]="{'govuk-form-group--error' : !totalIncome.valid && !totalIncome.pristine}">
        <label class="govuk-label" for="total-income">
          Total income
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.totalIncomeLatestTerm | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="total-income" name="total-income" type="text"
          formControlName='totalIncome'
          [class]="{'govuk-input--error' : !totalIncome.valid && !totalIncome.pristine}"
          (blur)="transformAmount($event, editDataForm.value.reserveBalance.totalIncome)"
          required>
        <div [hidden]="totalIncome.valid || totalIncome.pristine">
          <span class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Total income is required
          </span>
        </div>
      </div>

      <div class="govuk-form-group"
        [class]="{'govuk-form-group--error' : !totalExpenditure.valid && !totalExpenditure.pristine}">
        <label class="govuk-label" for="total-expenditure">
          Total expenditure
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.totalExpenditureLatestTerm | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="total-expenditure" name="total-expenditure" type="text"
          formControlName='totalExpenditure'
          [class]="{'govuk-input--error' : !totalExpenditure.valid && !totalExpenditure.pristine}"
          (blur)="transformAmount($event, editDataForm.value.reserveBalance.totalExpenditure)"
          required>
        <div [hidden]="totalExpenditure.valid || totalExpenditure.pristine">
          <span class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span> Total expenditure is required
          </span>
        </div>
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="rr">
          Revenue reserve
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Revenue reserve') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="rr" name="rr" type="text"
        formControlName='rr'
        (blur)="transformAmount($event, editDataForm.value.reserveBalance.rr)"
        >
      </div>
    </fieldset>

    <fieldset class="govuk-fieldset" formGroupName='spending'>
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        <h2 class="govuk-fieldset__heading">
          Expenditure
        </h2>
      </legend>

      <div class="govuk-form-group">
        <label class="govuk-label" for="ts">
          Spending on teaching staff
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Teaching staff') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="ts" name="ts" type="text"
        formControlName='teachingStaff'
        (blur)="transformAmount($event, editDataForm.value.spending.teachingStaff)"
        >
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="ss">
          Spending on supply staff
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Supply staff') | aaValueFormat }}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="ss" name="ss" type="text"
        formControlName='supplyStaff'
        (blur)="transformAmount($event, editDataForm.value.spending.supplyStaff)"
        >
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="ess">
          Spending on education support staff
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Education support staff') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="ess" name="ess" type="text"
          formControlName='educationSupportStaff'
          (blur)="transformAmount($event, editDataForm.value.spending.educationSupportStaff)"
          >
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="acs">
          Spending on administrative and clerical staff
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Administrative and clerical staff') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="acs" name="acs" type="text"
        formControlName='adminStaff'
        (blur)="transformAmount($event, editDataForm.value.spending.adminStaff)"
        >
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="osc">
          Spending on other staff costs
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Other staff costs') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="osc" name="osc" type="text"
        formControlName='otherStaff'
        (blur)="transformAmount($event, editDataForm.value.spending.otherStaff)"
        >
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="prc">
          Spending on premises costs
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Premises costs') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="prc" name="prc" type="text"
        formControlName='premises'
        (blur)="transformAmount($event, editDataForm.value.spending.premises)"
        >
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="tr">
          Spending on teaching resources
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Teaching resources') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="tr" name="tr" type="text"
          formControlName='teachingResources'
          (blur)="transformAmount($event, editDataForm.value.spending.teachingResources)"
          >
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="en">
          Spending on energy
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Energy') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="en" name="en" type="text"
        formControlName='energy'
        (blur)="transformAmount($event, editDataForm.value.spending.energy)"
        >
      </div>

    </fieldset>

<!--     <fieldset class="govuk-fieldset" formGroupName='character'>
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        <h2 class="govuk-fieldset__heading">
          School characteristics
        </h2>
      </legend>

      <div class="govuk-form-group">
        <label class="govuk-label" for="atc">
          Average teacher cost
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Average teacher cost') | aaValueFormat}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="atc" name="atc" type="text"
        formControlName='teacherCost'
        (blur)="transformAmount($event, editDataForm.value.character.teacherCost)"
        >
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="sl">
          Senior leaders as a percentage of workforce
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Senior leaders as a percentage of workforce') | aaValueFormat : 'Senior leaders as a percentage of workforce'}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="sl" name="sl" type="number" formControlName='seniorLeaders'>
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="ptt">
          Pupil to teacher ratio
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Pupil to teacher ratio') | aaValueFormat : 'Pupil to teacher ratio'}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="ptt" name="ptt" type="number" formControlName='pupilToTeacher'>
      </div>

      <div class="govuk-form-group">
        <label class="govuk-label" for="pta">
          Pupil to adult ratio
        </label>
        <span class="govuk-hint">
          The {{scenarioInEdit.latestTerm}} value was <span
            class="govuk-!-font-weight-bold">{{scenarioInEdit.getAALatestTermValue('Pupil to adult ratio') | aaValueFormat : 'Pupil to adult ratio'}}</span>
        </span>
        <input class="govuk-input govuk-input--width-20" id="pta" name="pta" type="number" formControlName='pupilToAdult'>
      </div>

    </fieldset> -->

    <div class="govuk-grid-row govuk-body">
      <div class="govuk-grid-column-full">
        <button *ngIf='viewType === "edit"' class="govuk-button" data-module="govuk-button" type="submit">
          Submit
        </button>
        <button *ngIf='viewType === "enter"' class="govuk-button" data-module="govuk-button" type="submit">
          Continue to the side-by-side scenario
        </button>
        <a (click)='onBack()' href="javascript:void(0)" class="govuk-link govuk-link--no-visited-state back-button">Back
        </a>
      </div>
    </div>

  </form>
</div>

<div [hidden]='scenarioLoaded'>Loading...</div>
